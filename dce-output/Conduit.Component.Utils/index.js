// Generated by purs version 0.13.8
"use strict";
var Control_Applicative = require("../Control.Applicative/index.js");
var Control_Bind = require("../Control.Bind/index.js");
var Control_Monad_Rec_Class = require("../Control.Monad.Rec.Class/index.js");
var Effect_Aff = require("../Effect.Aff/index.js");
var Effect_Aff_Bus = require("../Effect.Aff.Bus/index.js");
var Effect_Exception = require("../Effect.Exception/index.js");
var Halogen_Query_EventSource = require("../Halogen.Query.EventSource/index.js");
var busEventSource = function (dictMonadAff) {
    return function (bus) {
        return Halogen_Query_EventSource.affEventSource(dictMonadAff)(function (emitter) {
            return Control_Bind.bind(Effect_Aff.bindAff)(Effect_Aff.forkAff(Control_Monad_Rec_Class.forever(Effect_Aff.monadRecAff)(Control_Bind.bindFlipped(Effect_Aff.bindAff)(Halogen_Query_EventSource.emit(emitter))(Effect_Aff_Bus.read(bus)))))(function (fiber) {
                return Control_Applicative.pure(Effect_Aff.applicativeAff)(Effect_Aff.killFiber(Effect_Exception.error("Event source closed"))(fiber));
            });
        });
    };
};
module.exports = {
    busEventSource: busEventSource
};
